clone_folder: c:\projects\klusolve
# cache:
  # - c:\projects\SuiteSparse-5.3.0.tar.gz
  # - c:\projects\eigen3.tar.gz
build_script:
- cmd: >-
    ren c:\cygwin cygwin.disabled
    
    ren c:\cygwin64 cygwin64.disabled
    
    ren "C:\Program Files\Git" Git.disabled
    
    if exist c:\mingw ren c:\mingw mingw.disabled 
    
    if "%KLUSOLVE_USE_MINGW%"=="1" mklink /D c:\mingw C:\Qt\Tools\mingw530_32

    mkdir c:\projects\klusolve\build

    cd c:\projects\klusolve\build

    set path=%ADD_THIS_TO_PATH%;%path%

    cmake .. -DUSE_SYSTEM_SUITESPARSE=OFF -DUSE_SYSTEM_EIGEN3=OFF -G"%CMAKE_GENERATOR%" %CMAKE_EXTRA%

    cmake --build . --config Release

    cd c:\projects\klusolve
    
    dir /s lib
    
    if "%KLUSOLVE_USE_MINGW%"=="1" ren C:\projects\klusolve\lib\win_x86\libklusolve.dll libklusolve_mingw32.dll

    if "%KLUSOLVE_USE_MINGW%"=="1" appveyor PushArtifact C:\projects\klusolve\lib\win_x86\libklusolve_mingw32.dll
    
    if "%KLUSOLVE_USE_MINGW_W64%"=="1" ren C:\projects\klusolve\lib\win_x64\libklusolve.dll libklusolve_mingw-w64.dll

    if "%KLUSOLVE_USE_MINGW_W64%"=="1" appveyor PushArtifact C:\projects\klusolve\lib\win_x64\libklusolve_mingw-w64.dll
    
environment:
  matrix:
    # - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2013
      # CMAKE_GENERATOR: Visual Studio 9 2008
    # - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2013
      # CMAKE_GENERATOR: Visual Studio 9 2008 Win64
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      KLUSOLVE_USE_MINGW: 1
      ADD_THIS_TO_PATH: C:\MinGW\bin
      CMAKE_GENERATOR: MinGW Makefiles
      CMAKE_EXTRA: -DCMAKE_CXX_COMPILER_ARG1=-m32 -DCMAKE_C_COMPILER_ARG1=-m32
      KLUSOLVE_PACKAGE_NAME: klusolve-win_x86-gcc5.3
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      ADD_THIS_TO_PATH: C:\mingw-w64\x86_64-8.1.0-posix-seh-rt_v6-rev0\mingw64\bin
      CMAKE_GENERATOR: MinGW Makefiles
      KLUSOLVE_PACKAGE_NAME: klusolve-win_x86-gcc8.1
      KLUSOLVE_USE_MINGW_W64: 1
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      CMAKE_GENERATOR: Visual Studio 15 2017
      
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      CMAKE_GENERATOR: Visual Studio 15 2017 Win64
      

# deploy:
# - provider: GitHub
  # auth_token:
    # secure: 1eYtGksCZWZwjLNNMl5yjUoCDdEg9z1/6DdnR7fSU2wWUcKkp0Hpy0K2uvVYYEWK
  # artifact: /.*\.zip/
  # draft: true
  # force_update: true
  # on:
    # APPVEYOR_REPO_TAG: true
